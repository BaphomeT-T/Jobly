<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <base href="/">
  <title>Crear Vacante - Jobly</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
    }
  </style>
</head>
<body class="bg-[#fbfcfb] min-h-screen font-[Poppins,sans-serif] overflow-x-hidden">
  <!-- Header (Figma accurate) -->
  <header class="flex items-center justify-between px-[32px] pl-[32px] pr-[108px] pt-[24px] pb-[16px] border-b border-[#e5eae8] h-[86px] bg-white">
    <a href="/home-empresa" class="block h-[62px] w-[172px]">
      <img src="/static/images/logo-login.png" alt="Jobly Logo" class="h-full w-full object-contain" 
           onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27172%27 height=%2762%27%3E%3Crect width=%27172%27 height=%2762%27 fill=%27%23f23e8e%27/%3E%3Ctext x=%2750%25%27 y=%2750%25%27 dominant-baseline=%27middle%27 text-anchor=%27middle%27 fill=%27white%27 font-family=%27Arial%27 font-size=%2720%27%3EJobly%3C/text%3E%3C/svg%3E'" />
    </a>
    <div class="flex-1"></div>
    <div class="flex items-center gap-6">
      <!-- Help Icon -->
      <svg class="w-6 h-6 cursor-pointer" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="10" stroke="#141514" stroke-width="1.5"/>
        <path d="M9.09 9C9.325 8.33 9.835 7.81 10.5 7.57C11.165 7.33 11.903 7.39 12.516 7.74C13.129 8.09 13.563 8.69 13.72 9.38C13.877 10.07 13.745 10.79 13.35 11.38C12.955 11.97 12.33 12.38 11.62 12.51V13.5" stroke="#141514" stroke-width="1.5" stroke-linecap="round"/>
        <circle cx="12" cy="17" r="1" fill="#141514"/>
      </svg>
      <!-- Mail Icon -->
      <svg class="w-6 h-6 cursor-pointer" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M4 4H20C21.1 4 22 4.9 22 6V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4Z" stroke="#141514" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M22 6L12 13L2 6" stroke="#141514" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <!-- Profile Icon (Purple) -->
      <svg class="w-6 h-6 cursor-pointer" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="10" fill="#c89bfa"/>
        <circle cx="12" cy="10" r="3" fill="white"/>
        <path d="M6.168 18.849A6.5 6.5 0 0 1 12 15.5a6.5 6.5 0 0 1 5.832 3.349" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
    </div>
  </header>

  <!-- Subheader (Figma accurate) -->
  <section class="flex gap-[64px] items-end justify-center px-[108px] pt-[16px] pb-0 border-b border-[#e5eae8] h-[56px] bg-white relative">
    <!-- Tab 1: Nueva Vacante (Active - Purple) -->
    <div class="flex flex-col gap-[14px] items-center justify-center max-w-[130px] cursor-pointer tab-item active" data-tab="nueva-vacante">
      <p class="text-[#c89bfa] text-[20px] font-semibold text-center leading-[1] whitespace-nowrap tab-text">Nueva Vacante</p>
      <div class="w-full h-[3px] bg-gradient-to-r from-transparent via-[#c89bfa] to-transparent tab-line"></div>
    </div>
    
    <!-- Tab 2: Ver Vacantes -->
    <div class="flex flex-col gap-[14px] items-center justify-center max-w-[130px] cursor-pointer tab-item" data-tab="ver-vacantes" onclick="window.location.href='/ver-vacantes'">
      <p class="text-[#606261] text-[20px] font-medium text-center leading-[1.2] whitespace-nowrap tab-text">Ver Vacantes</p>
      <div class="w-full h-[3px] bg-transparent tab-line"></div>
    </div>
    
    <!-- Tab 3: Actividades -->
    <div class="flex flex-col gap-[14px] items-center justify-center max-w-[130px] cursor-pointer tab-item" data-tab="actividades" onclick="window.location.href='/actividades'">
      <p class="text-[#606261] text-[20px] font-medium text-center leading-[1.2] whitespace-nowrap tab-text">Actividades</p>
      <div class="w-full h-[3px] bg-transparent tab-line"></div>
    </div>
    
    <!-- Pattern decorations -->
    <div class="absolute bottom-0 left-[78px] top-0 w-[127px] opacity-10 pointer-events-none overflow-hidden">
      <img src="/static/images/pattern-login.png" alt="Pattern" class="absolute h-[239.29%] left-[-5.51%] top-[-71.43%] w-[105.51%] object-cover" 
           onerror="this.style.display='none'" />
    </div>
    <div class="absolute bottom-0 left-[198px] top-0 w-[84px] opacity-10 pointer-events-none overflow-hidden">
      <img src="/static/images/pattern-login.png" alt="Pattern" class="absolute h-[239.29%] left-[-7.14%] top-[-71.43%] w-[159.52%] object-cover" 
           onerror="this.style.display='none'" />
    </div>
    <div class="absolute bottom-0 right-[129px] top-0 w-[58px] opacity-10 pointer-events-none overflow-hidden">
      <img src="/static/images/pattern-login.png" alt="Pattern" class="absolute h-[239.29%] left-[-58.62%] top-[-71.43%] w-[231.03%] object-cover" 
           onerror="this.style.display='none'" />
    </div>
    <div class="absolute bottom-0 right-0 top-0 w-[127px] opacity-10 pointer-events-none overflow-hidden">
      <img src="/static/images/pattern-login.png" alt="Pattern" class="absolute h-[239.29%] left-[-5.51%] top-[-71.43%] w-[105.51%] object-cover" 
           onerror="this.style.display='none'" />
    </div>
  </section>

<main class="max-w-[600px] mx-auto px-4 pt-12 pb-24 bg-[#fbfcfb]">
  <!-- Barra de progreso + acciones -->
  <div class="flex items-center justify-between mb-8">
    <button type="button" onclick="window.history.back()" class="inline-flex items-center gap-2 text-[#141514]">
      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="#141514" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <span class="text-sm font-medium">Volver</span>
    </button>

    <div class="w-[260px] h-2 bg-[#f2ecfe] rounded-full overflow-hidden">
      <div class="h-full w-[50%] bg-[#b080e8]"></div>
    </div>

    <button type="button" onclick="window.location.href='/'" class="text-[16px] font-semibold text-[#141514] tracking-[0.48px]">
      Save And Exit
    </button>
  </div>

  <!-- Título -->
  <h1 class="text-[32px] font-semibold text-[#141514] leading-[1.2] mb-8">Crear Vacante</h1>

  <!-- Formulario -->
  <form id="vacanteForm" class="space-y-10">
    <!-- Modalidad -->
    <div>
    <label class="block text-[16px] font-semibold text-[#141514] tracking-[0.48px] mb-3">Modalidad*</label>
    <div class="flex flex-wrap gap-4">
        <button type="button"
        class="modalidad-btn bg-white border border-[#e5eae8] rounded-full px-4 py-2 hover:border-[#c89bfa] transition-colors"
        data-value="presencial" data-label="Presencial">
        <span class="text-[14px] font-medium text-[#141514]">Presencial</span>
        </button>

        <button type="button"
        class="modalidad-btn bg-white border border-[#e5eae8] rounded-full px-4 py-2 hover:border-[#c89bfa] transition-colors"
        data-value="virtual" data-label="Virtual">
        <span class="text-[14px] font-medium text-[#141514]">Virtual</span>
        </button>

        <button type="button"
        class="modalidad-btn bg-white border border-[#e5eae8] rounded-full px-4 py-2 hover:border-[#c89bfa] transition-colors"
        data-value="hibrido" data-label="Hibrido">
        <span class="text-[14px] font-medium text-[#141514]">Hibrido</span>
        </button>

        <button type="button"
        class="modalidad-btn bg-white border border-[#e5eae8] rounded-full px-4 py-2 hover:border-[#c89bfa] transition-colors"
        data-value="carretera" data-label="En la carretera">
        <span class="text-[14px] font-medium text-[#141514]">En la carretera</span>
        </button>
    </div>
    </div>

    <!-- Título -->
    <div>
      <label class="block text-[16px] font-semibold text-[#141514] tracking-[0.48px] mb-2">Título</label>
      <input
        type="text"
        name="titulo"
        placeholder="Título del puesto de trabajo"
        class="w-full h-[56px] px-4 border border-[#cfd4d1] rounded-[4px] text-[14px] font-medium text-[#141514] placeholder:text-[#b8bdbb] focus:border-[#c89bfa] focus:outline-none" />
    </div>

    <!-- Descripción -->
    <div>
      <label class="block text-[16px] font-semibold text-[#141514] tracking-[0.48px] mb-2">Descripción *</label>
      <textarea
        name="descripcion"
        rows="8"
        class="w-full px-4 py-4 border border-[#cfd4d1] rounded-[4px] text-[14px] font-medium text-[#141514] placeholder:text-[#b8bdbb] resize-none focus:border-[#c89bfa] focus:outline-none"></textarea>
    </div>

    <!-- Salario (decimal) -->
    <div>
      <label class="block text-[16px] font-semibold text-[#141514] tracking-[0.48px] mb-2">¿Cuál es el salario base? *</label>
      <div class="relative">
        <input
          type="text"
          inputmode="decimal"
          name="salario"
          placeholder="Ej. 2500.00"
          class="w-full h-[56px] px-4 pr-12 border border-[#cfd4d1] rounded-[4px] text-[14px] font-medium text-[#141514] placeholder:text-[#b8bdbb] focus:border-[#c89bfa] focus:outline-none"
          pattern="^\\d+(?:[\\.,]\\d{1,2})?$"
          aria-describedby="salarioHelp" />
        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-[#8a8f8d] text-sm">USD</span>
      </div>
      <p id="salarioHelp" class="mt-2 text-sm text-[#8a8f8d]">
        Solo números decimales, hasta 2 decimales. Ej.: 1200, 1200.5, 1200.50
      </p>
      <p id="salarioError" class="hidden mt-2 text-sm text-red-600">Ingresa un número válido (ej. 2500.00).</p>
    </div>

    <!-- Botón continuar -->
    <div class="pt-2">
      <button
        type="submit"
        class="bg-[#c89bfa] text-white px-6 py-3 rounded-full font-semibold text-[16px] h-[48px] hover:bg-[#b080e8] transition-colors">
        Continue
      </button>
    </div>
  </form>
</main>

<script>
document.addEventListener('DOMContentLoaded', function () {
  /* ======== Modalidad: estilo + valor guardado ======== */
  const modalidadBtns = document.querySelectorAll('.modalidad-btn');
  let modalidadSeleccionada = null;

  // Mapeo a las etiquetas solicitadas
  const modalidadMap = {
    presencial: 'Presencial',
    remoto: 'Virtual',      // <— tu botón dice "Remoto", pero guardaremos "Virtual"
    hibrido: 'Hibrido',
    carretera: 'En la carretera'
  };

  // Funciones de estilo
  const setInactive = (btn) => {
    btn.classList.remove('active');
    btn.classList.remove('bg-[#f2ecfe]', 'border-[#c89bfa]');
    btn.classList.add('bg-white', 'border', 'border-[#e5eae8]');
    // quitar icono si existiera
    const check = btn.querySelector('.check-icon');
    if (check) check.remove();
  };

  const setActive = (btn) => {
    btn.classList.add('active');
    // Moradito suave al fondo + borde
    btn.classList.remove('bg-white', 'border-[#e5eae8]');
    btn.classList.add('bg-[#f2ecfe]', 'border-[#c89bfa]');
  };

  modalidadBtns.forEach(btn => {
    // Quitar cualquier check inicial
    const check = btn.querySelector('.check-icon');
    if (check) check.remove();

    btn.addEventListener('click', () => {
      // reset estilos
      modalidadBtns.forEach(setInactive);
      // activar clickeado
      setActive(btn);

      // guardar el label correcto
      const raw = (btn.dataset.value || '').toLowerCase(); // 'presencial'|'hibrido'|'remoto'|'carretera'
      modalidadSeleccionada = modalidadMap[raw] || null;
    });
  });

  /* ======== Validación salario decimal + submit a API ======== */
  const form = document.getElementById('vacanteForm');
  const salarioInput = document.querySelector('input[name="salario"]');
  const errorEl = document.getElementById('salarioError');

  // Normaliza coma → punto mientras escribe
  salarioInput.addEventListener('input', () => {
    salarioInput.value = salarioInput.value.replace(',', '.');
  });

  form.addEventListener('submit', async function (e) {
    e.preventDefault();

    // Validación modalidad
    if (!modalidadSeleccionada) {
      alert('Selecciona la modalidad');
      return;
    }

    // Validación salario (más tolerante)
    const raw = (salarioInput.value || '').trim().replace(',', '.');
    // permitir enteros y decimales hasta 2 posiciones
    const parsed = Number(raw);
    if (!raw || !isFinite(parsed) || parsed < 0) {
      errorEl.classList.remove('hidden');
      salarioInput.focus();
      return;
    }
    // comprobar máximo 2 decimales si hay parte decimal
    const parts = raw.split('.');
    if (parts.length > 1 && parts[1].length > 2) {
      errorEl.classList.remove('hidden');
      salarioInput.focus();
      return;
    }
    errorEl.classList.add('hidden');
    const salarioNumber = parsed;

    // Campos
    const titulo = document.querySelector('input[name="titulo"]').value.trim();
    const descripcion = document.querySelector('textarea[name="descripcion"]').value.trim();

    if (!titulo) {
      alert('Ingresa un título');
      return;
    }

    // Email de la empresa (ajusta esta parte a tu sesión real)
    const empresaEmail = localStorage.getItem('authEmail') || ''; // <— CAMBIA si usas otra clave
    if (!empresaEmail) {
      alert('No se encontró el email de empresa en el cliente. Inicia sesión como Empresa.');
      return;
    }

    // Payload
    const payload = {
      titulo,
      descripcion,
      salario: salarioNumber,
      modalidad: modalidadSeleccionada,
      empresa_email: empresaEmail
    };

    try {
      const resp = await fetch('/api/vacantes/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      if (!resp.ok) {
        const err = await resp.json().catch(() => ({}));
        throw new Error(err.detail || 'Error creando la vacante');
      }

      const data = await resp.json();
      // Opcional: guardar algo localmente
      localStorage.setItem('ultimaVacanteId', data.id_vacante);

      // Redirigir a éxito
      window.location.href = '/vacante-publicada';
    } catch (err) {
      console.error(err);
      alert('No se pudo crear la vacante: ' + err.message);
    }
  });
});
</script>
 
</body>
</html>
